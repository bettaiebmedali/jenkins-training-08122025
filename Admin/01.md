Parfait â€” voici TP2, TP4, TP7, TP11 et TP14, un par un, chacun extrÃªmement dÃ©taillÃ©, et ent intÃ©gralitÃ© en Markdown dans des blocs de code (pas de preview).

âœ… TP2 â€“ Gestion des Utilisateurs, RÃ´les et SÃ©curitÃ© Jenkins (Version TrÃ¨s DÃ©taillÃ©e)
# TP2 â€“ Gestion des Utilisateurs, RÃ´les et SÃ©curitÃ© Jenkins (DÃ©taillÃ©)

## ğŸ¯ Objectifs
- SÃ©curiser Jenkins avec une authentification
- CrÃ©er des utilisateurs internes
- Installer et configurer le plugin RBAC (Role-Based Authorization Strategy)
- CrÃ©er plusieurs rÃ´les : admin, dev, viewer
- Donner des permissions granulaire aux utilisateurs
- Tester la configuration en se connectant avec diffÃ©rents comptes

---

# 1ï¸âƒ£ Activation de la sÃ©curitÃ© Jenkins

## Ã‰tape 1 : Activer la base utilisateurs Jenkins
Navigation :  
**Manage Jenkins â†’ Configure Global Security**

Cocher :

- [x] *Jenkinsâ€™ own user database*  
- [x] *Allow users to sign up* (optionnel)
- [x] *Require authentication to access Jenkins*

## Ã‰tape 2 : DÃ©finir une stratÃ©gie de sÃ©curitÃ©
SÃ©lectionner :


Authorization: Matrix-based security


Exemple permissions minimum pour lâ€™admin :


Overall â†’ Administer


â›” Important : **ne jamais retirer Administer Ã  lâ€™utilisateur admin avant test !**

---

# 2ï¸âƒ£ CrÃ©ation dâ€™utilisateurs

Chemin :
**Manage Jenkins â†’ Manage Users â†’ Create User**

CrÃ©er 3 utilisateurs :

1. **admin01**
2. **dev01**
3. **viewer01**

---

# 3ï¸âƒ£ Installation du plugin RBAC

Chemin :
**Manage Jenkins â†’ Manage Plugins â†’ Available**

Rechercher :


Role-based Authorization Strategy


Installer + redÃ©marrer Jenkins.

---

# 4ï¸âƒ£ Configuration RBAC

Chemin :
**Manage Jenkins â†’ Manage and Assign Roles â†’ Manage Roles**

CrÃ©er les rÃ´les :

## RÃ´le admin


Overall: Administer
Job: *
View: *
Credentials: *
Agent: *


## RÃ´le dev (permissions limitÃ©es)


Overall â†’ Read
Job â†’ Build
Job â†’ Configure
Job â†’ Read
Job â†’ Workspace
Credentials â†’ Use


## RÃ´le viewer (lecture seule)


Overall â†’ Read
Job â†’ Read
View â†’ Read


---

# 5ï¸âƒ£ Assignation des rÃ´les

Chemin :
**Manage and Assign Roles â†’ Assign Roles**

Assigner :

- admin01 â†’ admin
- dev01 â†’ dev
- viewer01 â†’ viewer

---

# 6ï¸âƒ£ Tests des comptes

## Test compte viewer01
Doit pouvoir :
- voir les jobs
Ne doit pas pouvoir :
- lancer un build
- modifier un job

## Test compte dev01
Doit pouvoir :
- lancer un job
- accÃ©der aux logs
Ne doit pas pouvoir :
- modifier les credentials
- gÃ©rer les agents
- installer plugins

## Test admin01
Doit pouvoir tout faire.

---

# 7ï¸âƒ£ Sauvegarde de la configuration sÃ©curitÃ©

Dans :


/var/lib/jenkins/config.xml


VÃ©rifier :

<authorizationStrategy class="...RoleBasedStrategy"> ```
Conclusion

Vous avez configurÃ© :

la sÃ©curitÃ© Jenkins

les rÃ´les

les permissions prÃ©cises

des utilisateurs avec accÃ¨s diffÃ©renciÃ©

Ce TP prÃ©pare lâ€™administration Ã  grande Ã©chelle.


---

# âœ… **TP4 â€“ Gestion des Nodes et ExÃ©cution DistribuÃ©e (Version TrÃ¨s DÃ©taillÃ©e)**

```md
# TP4 â€“ Gestion des Nodes Jenkins (DÃ©taillÃ©)

## ğŸ¯ Objectifs
- Ajouter un agent Jenkins (Linux)
- Utiliser lâ€™agent via SSH
- Installer les outils nÃ©cessaires
- ExÃ©cuter un pipeline sur un agent spÃ©cifique
- Diagnostiquer les erreurs de communication (agent offline)

---

# 1ï¸âƒ£ PrÃ©paration de la machine agent

Sur le serveur agent :

### Installer Java obligatoire
```bash
sudo apt update
sudo apt install -y openjdk-17-jdk

CrÃ©er un utilisateur Jenkins
sudo useradd -m -s /bin/bash jenkins
sudo passwd jenkins

Autoriser sudo (optionnel)
sudo usermod -aG sudo jenkins

2ï¸âƒ£ Ajouter une clÃ© SSH pour lâ€™agent

Sur le MASTER Jenkins :

Manage Jenkins â†’ Credentials â†’ System â†’ Global â†’ Add Credentials


Type :

SSH Username with private key


Username : jenkins

Private Key : (clÃ© privÃ©e)

ID : jenkins-agent-key

3ï¸âƒ£ Ajouter un nouvel agent dans Jenkins

Chemin :

Manage Jenkins â†’ Nodes â†’ New Node


ParamÃ¨tres :

Nom : linux-agent-01
Type : Permanent Agent

ParamÃ¨tres recommandÃ©s :
# of executors : 2
Remote root directory : /home/jenkins
Labels : linux docker build
Usage : Only build jobs with label restrictions
Launch method : Launch agents via SSH

4ï¸âƒ£ Tester la connexion SSH depuis le master

Depuis Jenkins master :

ssh -i /path/key jenkins@AGENT_IP


Si OK â†’ continuer
Si NOK â†’ vÃ©rifier :

Firewall

SSHD

Droits sur ~/.ssh

5ï¸âƒ£ Pipeline exÃ©cutÃ© sur lâ€™agent
pipeline {
  agent { label 'linux' }

  stages {
    stage('Check Agent') {
      steps {
        sh 'hostname'
        sh 'whoami'
        sh 'java -version'
      }
    }
  }
}

6ï¸âƒ£ DÃ©bogage Agent Offline
VÃ©rifier le log de lâ€™agent :
Manage Jenkins â†’ Nodes â†’ linux-agent-01 â†’ Logs

Causes frÃ©quentes :

Java absent

Mauvaise clÃ© SSH

Port 22 bloquÃ©

Droits sur /home/jenkins incorrects

Conclusion

Agent Jenkins installÃ©, configurÃ© et utilisÃ© dans un pipeline distribuÃ©.


---

# âœ… **TP7 â€“ Monitoring Jenkins (Version TrÃ¨s DÃ©taillÃ©e)**

```md
# TP7 â€“ Monitoring Jenkins (DÃ©taillÃ©)

## ğŸ¯ Objectifs
- Installer les plugins de monitoring
- Suivre CPU, RAM, Thread pools
- Configurer une politique dâ€™alertes
- Mettre en place un parsing des logs
- Comprendre l'Ã©tat de santÃ© Jenkins

---

# 1ï¸âƒ£ Installer les plugins de monitoring

Plugins nÃ©cessaires :
- **Monitoring**
- **Metrics**
- **Prometheus Metrics**
- **Health Advisor by CloudBees**
- **Log Parser Plugin**

Installation :  
Manage Jenkins â†’ Manage Plugins â†’ Available

---

# 2ï¸âƒ£ Monitoring Plugin

Une fois installÃ© :


Dashboard â†’ Monitoring


Indicateurs affichÃ©s :
- CPU usage (master + agents)
- Heap memory
- Non-heap memory
- Garbage Collector
- Thread usage
- File descriptor usage
- Load average

---

# 3ï¸âƒ£ Log Parser â€“ Analyse des logs

CrÃ©er un fichier de rÃ¨gles :


ERROR\s.*
WARN\s.*
Exception
Traceback


Uploader :


Manage Jenkins â†’ Log Parser â†’ Create a new rule


Puis dans un job :


Post-build Action â†’ Console output parsing


---

# 4ï¸âƒ£ Health Advisor by CloudBees

FonctionnalitÃ©s :
- analyse automatique Jenkins
- recommandation de sÃ©curitÃ©
- dÃ©tection de jobs obsolÃ¨tes
- dÃ©tection dâ€™agents saturÃ©s

Chemin :


Manage Jenkins â†’ Health Advisor by CloudBees


---

# 5ï¸âƒ£ Exposition des mÃ©triques Prometheus

Endpoint :


http://JENKINS:8080/prometheus/


Ajouter dans Prometheus :


scrape_configs:

job_name: 'jenkins'
static_configs:

targets: ['IP:8080']


---

# 6ï¸âƒ£ Alertes recommandÃ©es

- CPU > 80%
- Heap Memory > 70%
- Queue Size > 50 jobs
- Executor Saturation > 90%
- Agent offline > 5 minutes

---

# Conclusion
Un Jenkins bien monitorÃ© Ã©vite la plupart des pannes (OOM, saturation, agents offline).

âœ… TP11 â€“ Shared Library AvancÃ©e (TrÃ¨s DÃ©taillÃ©)
# TP11 â€“ Shared Library (DÃ©taillÃ©)

## ğŸ¯ Objectifs
- CrÃ©er une Shared Library complÃ¨te
- Ajouter plusieurs fonctions globales
- Ajouter une classe utilitaire avancÃ©e
- Importer la librairie dans un pipeline
- Tester lâ€™intÃ©gration

---

# 1ï¸âƒ£ Structure complÃ¨te du repo Shared Library



jenkins-shared-library/
â”œâ”€â”€ vars/
â”‚ â”œâ”€â”€ sayHello.groovy
â”‚ â”œâ”€â”€ buildApp.groovy
â”‚ â”œâ”€â”€ sendNotification.groovy
â””â”€â”€ src/org/example/
â”œâ”€â”€ Utils.groovy
â””â”€â”€ DockerHelper.groovy


---

# 2ï¸âƒ£ Fichier vars/sayHello.groovy

```groovy
def call(String name = 'World') {
  echo "Hello, ${name}!"
}

3ï¸âƒ£ Fichier vars/buildApp.groovy
def call() {
  echo "Building app..."
  sh 'mvn clean package'
}

4ï¸âƒ£ src/org/example/Utils.groovy
package org.example

class Utils {
  static String formatDate() {
    return new Date().format("yyyy-MM-dd HH:mm:ss")
  }

  static void printBanner(String msg) {
    println "========================"
    println " ${msg}"
    println "========================"
  }
}

5ï¸âƒ£ Pipeline utilisant la Shared Library
@Library('jenkins-shared-library') _

pipeline {
  agent any

  stages {
    stage("Test Library") {
      steps {
        script {
          sayHello("DevOps Student")

          def utils = new org.example.Utils()
          utils.printBanner("Starting build...")

          buildApp()

          echo "Time: ${utils.formatDate()}"
        }
      }
    }
  }
}

Conclusion

Shared Library avancÃ©e = code rÃ©utilisable, pipelines plus courts, meilleur versionning.


---

# âœ… **TP14 â€“ Gestion des Secrets avec Vault / SOPS / Credentials (TrÃ¨s DÃ©taillÃ©)**

```md
# TP14 â€“ Gestion des Secrets (Vault / SOPS / Credentials)

## ğŸ¯ Objectifs
- Comprendre les stratÃ©gies de gestion des secrets
- IntÃ©grer Vault avec Jenkins
- Utiliser des secrets dynamiques
- IntÃ©grer les secrets Jenkins dans un pipeline

---

# 1ï¸âƒ£ Installation HashiCorp Vault (Dev Mode)

```bash
vault server -dev
export VAULT_ADDR=http://127.0.0.1:8200

2ï¸âƒ£ CrÃ©er un secret Vault
vault kv put secret/app api_key="123456789" password="s3cr3t"

3ï¸âƒ£ Configuration du plugin Vault dans Jenkins

Chemin :

Manage Jenkins â†’ Configure System â†’ HashiCorp Vault


Configurer :

Vault URL

Token

Engine Version : KV2

4ï¸âƒ£ Pipeline utilisant Vault
pipeline {
  agent any

  environment {
    VAULT_ADDR = "http://127.0.0.1:8200"
  }

  stages {
    stage("Read secrets") {
      steps {
        withVault(
          configuration: [
            vaultUrl: "http://127.0.0.1:8200",
            credentialsId: "vault-token"
          ],
          vaultSecrets: [
            [path: "secret/data/app", secretValues: [
              [envVar: 'API_KEY', vaultKey: 'api_key'],
              [envVar: 'PASSWORD', vaultKey: 'password']
            ]]
          ]
        ) {
          sh 'echo "Key: $API_KEY"'
          sh 'echo "Password: $PASSWORD"'
        }
      }
    }
  }
}

5ï¸âƒ£ Secrets dynamiques (exemple MySQL)

Activer le backend DB :

vault secrets enable database


Vault va gÃ©nÃ©rer :

un login unique

un mot de passe unique

valides 1 heure

6ï¸âƒ£ SOPS (si Kubernetes / GitOps)

Exemple fichier chiffrÃ© :

api_key: ENC[AES256_GCM,...]

Conclusion

Ce TP introduit les secrets sÃ©curisÃ©s et lâ€™intÃ©gration Vault dans les pipelines.


---

Si tu veux, je peux aussi crÃ©er :

âœ… **un dossier GitHub complet** contenant tous ces TP  
ou  
âœ… **un PDF par TP**  
ou  
âœ… **une version corrigÃ©e + un TP dâ€™Ã©valuation**  

Souhaites-tu la suite ?