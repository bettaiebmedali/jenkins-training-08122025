# TP Chapitre 8 ‚Äì Gestion des branches GitLab et GitFlow üåø

## Contexte / Storytelling
La startup GFP Tech grandit et plusieurs d√©veloppeurs travaillent simultan√©ment.  
Pour organiser les d√©veloppements et automatiser les pipelines Jenkins, il est crucial d‚Äôadopter **GitFlow** et de g√©rer correctement les branches dans GitLab.  
Ce TP vous permet de mettre en place un pipeline **multibranch** qui d√©tecte les commits et les Merge Requests pour chaque type de branche.

---

## Objectifs p√©dagogiques
- Comprendre la **strat√©gie GitFlow** : feature, develop, release, hotfix, main.  
- Configurer Jenkins pour un **pipeline multibranch**.  
- Automatiser le build et tests selon le type de branche.  
- D√©clencher des pipelines sur commits et Merge Requests (MR).  
- G√©rer les artefacts et d√©ploiements conditionnels selon la branche.

---

## Pr√©requis techniques
- Jenkins avec pipelines Chapitre 1 √† 7.  
- Projet Maven dans GitLab.  
- Plugin GitLab Branch Source install√© sur Jenkins.  
- Droits pour configurer Webhooks GitLab ‚Üí Jenkins.

---

## √âtapes d√©taill√©es

### **1. Pr√©parer le repository GitLab**
1. Cr√©er les branches principales selon GitFlow :
   ```bash
   git checkout -b develop
   git checkout -b release/1.0
   git checkout -b hotfix/1.0.1
   git push origin develop release/1.0 hotfix/1.0.1
   ```
2. Cr√©er une feature branch :
   ```bash
   git checkout -b feature/login
   git push origin feature/login
   ```

### **2. Configurer le pipeline multibranch**
1. Dans Jenkins : **New Item ‚Üí Multibranch Pipeline**.  
2. Configurer le **GitLab Branch Source** :  
   - URL du repo  
   - Credentials GitLab  
   - Discovery : Branches et Merge Requests
3. Jenkins d√©tecte automatiquement toutes les branches et MR et cr√©e des jobs pour chacune.

### **3. Adapter le Jenkinsfile pour GitFlow**
Exemple :

```groovy
pipeline {
    agent any
    stages {
        stage('Build') {
            steps {
                echo "üõ†Ô∏è Build de la branche ${env.BRANCH_NAME}"
                sh 'mvn clean compile'
            }
        }
        stage('Test') {
            steps {
                sh 'mvn test'
            }
        }
        stage('Deploy') {
            when {
                branch 'release/*'
            }
            steps {
                echo "üöÄ D√©ploiement pour la branche ${env.BRANCH_NAME}"
                sh "./deploy.sh staging ${env.BUILD_NUMBER}"
            }
        }
    }
}
```

### **4. D√©clenchement automatique**
1. Configurer **Webhooks GitLab ‚Üí Jenkins** pour que chaque commit ou MR d√©clenche un build.  
2. V√©rifier que les pipelines s‚Äôex√©cutent pour :  
   - Feature branches : build + tests  
   - Release branches : build + tests + d√©ploiement staging  
   - Main : build + tests + d√©ploiement prod

### **5. Tester et valider**
1. Cr√©er un commit sur une feature branch et ouvrir un MR.  
2. Observer la cr√©ation automatique du job Jenkins pour cette MR.  
3. Fusionner le MR dans develop et v√©rifier l‚Äôex√©cution du pipeline.  
4. Cr√©er un release branch et observer le d√©ploiement automatique sur staging.

---

## Livrable final
- Pipeline Jenkins multibranch fonctionnel.  
- Int√©gration compl√®te avec GitLab et Webhooks.  
- Pipelines adapt√©s selon le type de branche GitFlow.  
- D√©ploiement conditionnel sur release/main.

---

## Bonus (optionnel)
- Ajouter un **stage de notification Slack** pour chaque MR.  
- Ajouter un **test de s√©curit√© ou SonarQube** pour release branches.  
- D√©clencher le d√©ploiement Blue-Green pour la branche main.
~~~

