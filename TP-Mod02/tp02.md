# TP Chapitre 2 ‚Äì Pipeline avanc√© ‚ö°

## Contexte / Storytelling
La startup GFP Tech se d√©veloppe et plusieurs d√©veloppeurs travaillent sur le projet.  
Il devient n√©cessaire d‚Äôintroduire **des pipelines plus avanc√©s** : param√®tres, parall√©lisation, gestion des erreurs et ex√©cution dans des environnements Docker.  
Vous allez am√©liorer le pipeline simple pour qu‚Äôil supporte plusieurs sc√©narios et conditions r√©elles.

---

## Objectifs p√©dagogiques
- Ajouter des **param√®tres de pipeline** pour plus de flexibilit√©.  
- Impl√©menter des **stages parall√®les** pour gagner du temps.  
- Ajouter la **gestion des erreurs** dans le pipeline.  
- Ex√©cuter les √©tapes du pipeline dans **Docker** pour isoler l‚Äôenvironnement.

---

## Pr√©requis techniques
- Jenkins avec pipeline simple existant (Chapitre 1).  
- Docker install√© sur le Master ou les agents Jenkins.  
- Projet Maven de base dans GitLab.  

---

## √âtapes d√©taill√©es

### **1. Ajouter des param√®tres au pipeline**
Modifier le `Jenkinsfile` pour inclure des param√®tres :

```groovy
pipeline {
    agent any
    parameters {
        string(name: 'BRANCH_NAME', defaultValue: 'main', description: 'Branche √† construire')
        choice(name: 'ENV', choices: ['dev', 'staging', 'prod'], description: 'Environnement cible')
    }
    stages {
        stage('Build') {
            steps {
                echo "üõ†Ô∏è Build de la branche ${params.BRANCH_NAME} pour ${params.ENV}"
                sh "mvn clean compile -P${params.ENV}"
            }
        }
        stage('Test') {
            steps {
                echo '‚úÖ Ex√©cution des tests unitaires...'
                sh 'mvn test'
            }
        }
    }
}
```

### **2. Ajouter des stages parall√®les**
Modifier le pipeline pour ex√©cuter **tests unitaires et analyse statique en parall√®le** :

```groovy
stage('Parallel Steps') {
    parallel {
        stage('Unit Tests') {
            steps {
                sh 'mvn test'
            }
        }
        stage('Static Analysis') {
            steps {
                sh 'mvn sonar:sonar'
            }
        }
    }
}
```

### **3. Ajouter la gestion des erreurs**
Utiliser `post` pour notifier en cas d‚Äô√©chec :

```groovy
post {
    failure {
        echo "‚ö†Ô∏è Pipeline √©chou√© !"
        mail to: 'team@gfptech.com', subject: "Build Failed", body: "Pipeline √©chou√© sur ${env.BRANCH_NAME}"
    }
}
```

### **4. Ex√©cuter le pipeline dans Docker**
1. Cr√©er un agent Docker dans Jenkins :

```groovy
agent {
    docker {
        image 'maven:3.9.0-openjdk-17'
        args '-v /root/.m2:/root/.m2'
    }
}
```
2. Lancer le pipeline et v√©rifier que toutes les √©tapes s‚Äôex√©cutent dans le container Docker.

### **5. Tester le pipeline**
1. D√©clencher le pipeline avec diff√©rents param√®tres (`BRANCH_NAME` et `ENV`).  
2. Observer les √©tapes parall√®les et v√©rifier que les notifications fonctionnent en cas d‚Äô√©chec.  
3. V√©rifier que Docker est utilis√© pour toutes les √©tapes du build.

---

## Livrable final
- Pipeline Jenkins avanc√© avec :  
  - Param√®tres dynamiques  
  - Stages parall√®les  
  - Gestion des erreurs  
  - Ex√©cution Docker  
- Rapport de build avec logs complets et notifications en cas d‚Äô√©chec

---

## Bonus (optionnel)
- Ajouter un stage pour g√©n√©rer les **artefacts Maven** et les stocker localement ou dans Nexus.  
- Ajouter des **tests de performance JMeter** en parall√®le avec les tests unitaires.
~~~

