# TP Chapitre 3 â€“ Mutualisation des pipelines ğŸ”„

## Contexte / Storytelling
La startup GFP Tech grandit et de nombreux pipelines se rÃ©pÃ¨tent dans diffÃ©rents projets.  
Pour gagner du temps et assurer la cohÃ©rence, vous allez crÃ©er **des librairies de pipelines rÃ©utilisables** en Groovy.  
Cela permettra de partager des fonctions communes, comme lâ€™envoi de notifications ou la compilation, entre plusieurs pipelines.

---

## Objectifs pÃ©dagogiques
- CrÃ©er une **librairie de pipeline partagÃ©e** (Shared Library) dans Jenkins.  
- ImplÃ©menter des **fonctions rÃ©utilisables** en Groovy.  
- Ajouter des **tests unitaires** pour la librairie.  
- IntÃ©grer la librairie dans un pipeline existant.

---

## PrÃ©requis techniques
- Jenkins avec Chapitre 1 et 2 configurÃ©s.  
- Projet Maven simple sur GitLab.  
- AccÃ¨s administrateur Jenkins pour publier la librairie.  

---

## Ã‰tapes dÃ©taillÃ©es

### **1. CrÃ©er la structure de la librairie**
Dans un repo Git distinct ou dans le mÃªme projet, crÃ©er la structure :

```
(gfptech-pipeline-lib)
 â”œâ”€â”€ vars
 â”‚   â””â”€â”€ notifySlack.groovy
 â””â”€â”€ src
     â””â”€â”€ org/gfptech/utils/
         â””â”€â”€ Helper.groovy
```

### **2. Ajouter une fonction rÃ©utilisable**
Exemple `vars/notifySlack.groovy` :

```groovy
def call(String channel, String message) {
    echo "ğŸ“£ Notification Slack pour ${channel}: ${message}"
    // Ici, ajouter un appel rÃ©el Ã  lâ€™API Slack si besoin
}
```

Exemple `src/org/gfptech/utils/Helper.groovy` :

```groovy
package org.gfptech.utils

class Helper {
    static String formatMessage(String project, String status) {
        return "${project} - Build status: ${status}"
    }
}
```

### **3. Publier la librairie dans Jenkins**
1. Aller dans **Manage Jenkins â†’ Configure System â†’ Global Pipeline Libraries**  
2. Ajouter la librairie :  
   - Nom : `gfptech-lib`  
   - Default version : `main`  
   - Repository : URL Git de la librairie  
   - Load implicitly : optionnel  

### **4. IntÃ©grer la librairie dans un pipeline**
Modifier un `Jenkinsfile` existant pour utiliser la librairie :

```groovy
@Library('gfptech-lib') _

pipeline {
    agent any
    stages {
        stage('Notify') {
            steps {
                notifySlack('dev-team', 'Pipeline dÃ©marrÃ©')
            }
        }
    }
}
```

### **5. Tester la librairie**
1. DÃ©clencher le pipeline sur Jenkins.  
2. VÃ©rifier que la fonction `notifySlack` fonctionne et affiche le message.  
3. Ajouter un autre pipeline qui utilise `Helper.formatMessage` pour dÃ©montrer la rÃ©utilisation.  

### **6. Ajouter des tests unitaires pour la librairie**
1. CrÃ©er des tests Groovy avec `JUnit` ou `Spock` dans `src/test/groovy`.  
2. Tester la fonction `Helper.formatMessage` pour diffÃ©rents inputs.  
3. ExÃ©cuter les tests via pipeline pour valider la librairie.

---

## Livrable final
- Une librairie Jenkins rÃ©utilisable et testÃ©e.  
- Pipeline existant utilisant la librairie pour envoyer des notifications et formatter des messages.  
- Tests unitaires validÃ©s dans Jenkins.

---

## Bonus (optionnel)
- Ajouter une fonction pour **build Maven** rÃ©utilisable.  
- Ajouter une fonction pour **dÃ©ployer Docker** dans la librairie et la rÃ©utiliser dans plusieurs pipelines.
~~~

