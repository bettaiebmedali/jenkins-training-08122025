# TP Chapitre 4 ‚Äì Automatisation des tests üß™

## Contexte / Storytelling
La startup GFP Tech souhaite garantir la **qualit√© du code** sur tous les pipelines.  
Apr√®s avoir mis en place les pipelines et la mutualisation, il est temps d‚Äôautomatiser **les tests unitaires, d‚Äôint√©gration et de performance** pour d√©tecter les erreurs rapidement et am√©liorer la fiabilit√© du projet.

---

## Objectifs p√©dagogiques
- Ajouter des tests unitaires et d‚Äôint√©gration automatis√©s dans le pipeline Jenkins.  
- G√©n√©rer et visualiser des **rapports de tests**.  
- Mesurer la **couverture de code**.  
- Ajouter des tests de performance JMeter et suivre leur r√©sultat.  
- Optimiser l‚Äôex√©cution des tests pour un pipeline efficace.

---

## Pr√©requis techniques
- Jenkins avec pipelines pr√©c√©dents configur√©s.  
- Projet Maven Java avec tests unitaires existants.  
- Jenkins Plugin **JUnit** et **Performance** install√©.  
- JMeter install√© (local ou sur agent Jenkins).

---

## √âtapes d√©taill√©es

### **1. Ajouter les tests unitaires et d‚Äôint√©gration**
1. Cr√©er ou v√©rifier les tests JUnit dans `src/test/java`.  
2. Pour les tests d‚Äôint√©gration, ajouter des tests dans `src/integration-test/java`.  
3. Ajouter un profil Maven pour diff√©rencier tests unitaires et d‚Äôint√©gration :
   ```xml
   <profiles>
       <profile>
           <id>integration-test</id>
           <build>
               <plugins>
                   <plugin>
                       <groupId>org.apache.maven.plugins</groupId>
                       <artifactId>maven-surefire-plugin</artifactId>
                   </plugin>
               </plugins>
           </build>
       </profile>
   </profiles>
   ```

### **2. Modifier le pipeline pour ex√©cuter les tests**
Dans le `Jenkinsfile` :

```groovy
stage('Unit Tests') {
    steps {
        sh 'mvn test'
    }
    post {
        always {
            junit '**/target/surefire-reports/*.xml'
        }
    }
}

stage('Integration Tests') {
    steps {
        sh 'mvn verify -Pintegration-test'
    }
    post {
        always {
            junit '**/target/failsafe-reports/*.xml'
        }
    }
}
```

### **3. Ajouter analyse de couverture**
1. Ajouter le plugin **JaCoCo** dans le `pom.xml`.  
2. Ajouter un stage Jenkins pour g√©n√©rer le rapport de couverture :

```groovy
stage('Code Coverage') {
    steps {
        sh 'mvn jacoco:report'
        publishHTML(target: [
            reportName: 'Coverage Report',
            reportDir: 'target/site/jacoco',
            reportFiles: 'index.html',
            keepAll: true
        ])
    }
}
```

### **4. Ajouter tests de performance avec JMeter**
1. Cr√©er un test JMeter (`.jmx`) pour le projet.  
2. Ajouter un stage Jenkins pour ex√©cuter le test :

```groovy
stage('Performance Test') {
    steps {
        sh 'jmeter -n -t tests/performance/test.jmx -l results.jtl'
        perfReport sourceDataFiles: 'results.jtl'
    }
}
```

### **5. Ex√©cuter et v√©rifier**
1. D√©clencher le pipeline et v√©rifier que toutes les √©tapes passent.  
2. Consulter les rapports : JUnit, JaCoCo, JMeter.  
3. Observer les r√©sultats dans Jenkins et identifier les probl√®mes √©ventuels.

---

## Livrable final
- Pipeline Jenkins ex√©cutant :  
  - Tests unitaires et d‚Äôint√©gration  
  - G√©n√©ration de rapports JUnit  
  - Analyse de couverture avec JaCoCo  
  - Tests de performance JMeter  
- Rapport complet visible dans Jenkins.

---

## Bonus (optionnel)
- Ajouter parall√©lisation des tests unitaires et d‚Äôint√©gration.  
- D√©clencher tests de performance uniquement sur certaines branches (ex: release/main).  
- Ajouter notifications Slack pour les tests √©chou√©s.
~~~

